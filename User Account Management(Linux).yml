---
- name: Create User Account
  hosts: your_target_machine
  become: yes # Run tasks with sudo (root) privileges

  vars:
    username: newuser
    password: "{{ 'your_encrypted_password' | password_hash('sha512', 'my_salt') }}" # You can generate encrypted password using 'mkpasswd' or similar tools

  tasks:
    - name: Create user
      user:
        name: "{{ username }}"
        password: "{{ password }}"
        state: present
        groups: wheel # You can customize additional groups as needed
        shell: /bin/bash # You can change the shell if needed

    - name: Add SSH key to authorized_keys
      authorized_key:
        user: "{{ username }}"
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}" # Use the path to your SSH public key file

    - name: Set up sudo privileges
      lineinfile:
        dest: /etc/sudoers
        line: "{{ username }} ALL=(ALL) NOPASSWD: ALL"
        validate: "visudo -cf %s" # Check sudoers file syntax


    # Add any additional tasks as needed
